I need to fix and extend my guided tour system in the Workflow Builder.

â¸»

ğŸ 1. Fix Bug: Tour Disappears After Step 3

Problem:
After step 3 the tour overlay disappears completely and does not continue.

Required Fix:
 1. Ensure tour state is NOT reset between steps.
 2. Do NOT unmount the Tour component until:
 â€¢ User clicks Finish
 â€¢ Or explicitly clicks Skip
 3. Make sure step index is stored in state properly:
 â€¢ useRef or centralized store
 â€¢ Not reinitialized on re-render
 4. Prevent component remounting when:
 â€¢ Card panel opens
 â€¢ Canvas re-renders
 â€¢ Node position changes
 5. If target element is temporarily unavailable:
 â€¢ Wait until element exists (MutationObserver or polling)
 â€¢ Do NOT terminate tour
 6. Ensure overlay is rendered in a stable root (Portal to document.body).
 7. Add console logging for:
 â€¢ Current step index
 â€¢ Target selector
 â€¢ Element existence
 8. Disable any auto-cleanup logic tied to route changes.

Expected result:
Tour continues beyond step 3 without disappearing.

â¸»

ğŸ”’ 2. Force User Flow: Mandatory Builder â†’ Mandatory Card Settings

I need to enforce a strict onboarding sequence.

User must:

Step 1 â†’ Enter Workflow Builder
Step 2 â†’ Add or select a card
Step 3 â†’ Open card settings panel
Step 4 â†’ Complete card settings tutorial

User must NOT skip these transitions.

â¸»

ğŸ¯ Required Implementation

Phase 1 â€” Dashboard â†’ Builder

If user has not completed onboarding:
 â€¢ Disable other dashboard navigation
 â€¢ Highlight only â€œWorkflow Builderâ€
 â€¢ Block clicks on other sidebar items
 â€¢ Force user to click Builder

After entering Builder â†’ automatically start Builder Tour.

â¸»

Phase 2 â€” Force Card Creation / Selection

During Builder tour:
 â€¢ Highlight â€œAdd Cardâ€ button
 â€¢ Prevent canvas interaction except required action
 â€¢ User must click Add Card to proceed
 â€¢ After card appears â†’ automatically move to next step

â¸»

Phase 3 â€” Force Open Card Settings
 â€¢ Highlight created card
 â€¢ Disable drag during this step
 â€¢ Require user to click the card
 â€¢ Automatically open settings panel

If panel fails to open â†’ programmatically trigger open.

â¸»

Phase 4 â€” Card Settings Guided Tour

Once settings panel opens:
 â€¢ Lock builder interactions
 â€¢ Run Card Settings Tour
 â€¢ Auto-expand Basic section
 â€¢ Then auto-enable Advanced Mode
 â€¢ Explain everything step-by-step

User cannot exit until:
 â€¢ Tour finished
OR
 â€¢ Explicit Skip confirmation modal

â¸»

ğŸ” Interaction Locking Rules

During forced onboarding:
 â€¢ Disable sidebar navigation
 â€¢ Disable other builder buttons
 â€¢ Disable canvas zoom/drag (except required step)
 â€¢ Disable edge creation
 â€¢ Disable node dragging when not needed

Overlay must block pointer events globally except allowed element.

â¸»

ğŸ§  State Control

Use a centralized onboarding controller:

onboardingPhase:
 â€¢ â€œdashboardâ€
 â€¢ â€œbuilderâ€
 â€¢ â€œcardâ€
 â€¢ â€œcompletedâ€

Persist state in localStorage:

â€œonboardingPhaseâ€

Do NOT mark as completed until:
Card settings tour finished.

â¸»

ğŸ§© Stability Requirements
 â€¢ If user refreshes page â†’ resume from last onboarding phase.
 â€¢ If card was deleted â†’ recreate automatically.
 â€¢ If builder loads async â†’ wait before starting step.
 â€¢ No flickering.
 â€¢ No disappearing overlay.

â¸»

ğŸ¯ Expected Result

New user enters site â†’
Only Builder is clickable â†’
User forced into Builder â†’
Forced to create card â†’
Forced to open settings â†’
Complete full guided explanation â†’
Only then onboarding ends.

Tour never disappears unexpectedly.